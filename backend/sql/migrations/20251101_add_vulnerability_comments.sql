-- Add vulnerability comments table
-- Date: 2025-11-01

CREATE TABLE IF NOT EXISTS vulnerability_comment (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  uuid VARCHAR(36) NOT NULL UNIQUE,
  vulnerability_metadata_id BIGINT NOT NULL,
  user_id BIGINT NOT NULL,
  parent_id BIGINT NULL,
  content TEXT NOT NULL,
  is_edited TINYINT(1) NOT NULL DEFAULT 0,
  status VARCHAR(16) NOT NULL DEFAULT 'ACTIVE', -- ACTIVE|HIDDEN|DELETED
  create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) COMMENT='漏洞评论表';

-- Indexes
CREATE INDEX idx_vc_vuln_id_ctime ON vulnerability_comment(vulnerability_metadata_id, create_time);
CREATE INDEX idx_vc_user_id ON vulnerability_comment(user_id);
CREATE INDEX idx_vc_parent_id ON vulnerability_comment(parent_id);
CREATE INDEX idx_vc_status ON vulnerability_comment(status);
CREATE INDEX idx_vc_uuid ON vulnerability_comment(uuid);

