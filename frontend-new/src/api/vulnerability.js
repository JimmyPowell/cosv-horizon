import apiClient from './index';

export default {
  list(params = {}) {
    // params may include: organizationUuid, page, size, sortBy, sortOrder, withTotal, language, status, identifierPrefix, tag, tagCode, category
    return apiClient.get('/vulns', { params });
  },
  // Advanced search with optional multi-language and severity filters
  // Supported optional params:
  // - languages: string | string[] (CSV or array of enums)
  // - severityLevels: string | string[] (CSV or array of CRITICAL|HIGH|MEDIUM|LOW)
  // - severityGe, severityLe: number (optional numeric range)
  // - plus common filters: q, status, identifierPrefix, organizationUuid, category, sortBy, sortOrder, page, size, withTotal
  listSearch(params = {}) {
    const p = { ...params };
    // Normalize arrays to CSV for backend expectations
    if (Array.isArray(p.languages)) p.languages = p.languages.filter(Boolean).join(',');
    if (Array.isArray(p.severityLevels)) p.severityLevels = p.severityLevels.filter(Boolean).join(',');
    return apiClient.get('/vulns/search', { params: p });
  },
  getByUuid(uuid) {
    return apiClient.get(`/vulns/${uuid}`);
  },
  create(payload) {
    return apiClient.post('/vulns', payload);
  },
  update(uuid, payload) {
    return apiClient.patch(`/vulns/${uuid}`, payload);
  },
  delete(uuid) {
    return apiClient.delete(`/vulns/${uuid}`);
  },
  // Comments
  listComments(uuid, params = {}) {
    return apiClient.get(`/vulns/${uuid}/comments`, { params });
  },
  addComment(uuid, payload) {
    return apiClient.post(`/vulns/${uuid}/comments`, payload);
  },
  deleteComment(uuid, commentUuid) {
    return apiClient.delete(`/vulns/${uuid}/comments/${commentUuid}`);
  },
};
